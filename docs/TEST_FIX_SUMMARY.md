# æµ‹è¯•ç³»ç»Ÿä¿®å¤æ€»ç»“

## âœ… å·²è§£å†³çš„é—®é¢˜

### 1. ç¼ºå¤±çš„ä¾èµ–
**é—®é¢˜**: `ModuleNotFoundError: No module named 'jieba'`

**è§£å†³æ–¹æ¡ˆ**:
- åœ¨ `backend/requirements.txt` ä¸­æ·»åŠ äº† `jieba==0.42.1`
- è¿è¡Œ `pip install jieba` å®‰è£…ä¾èµ–

### 2. å¯¼å…¥é”™è¯¯
**é—®é¢˜**: æ— æ³•ä» `models` å¯¼å…¥ `db`, `User` ç­‰

**è§£å†³æ–¹æ¡ˆ**:
- ä¿®æ”¹ `conftest.py` ä» `models.database` å¯¼å…¥è€Œä¸æ˜¯ `models`
- ç§»é™¤äº†ä¸å­˜åœ¨çš„ `Question` æ¨¡å‹å¼•ç”¨
- ä½¿ç”¨å®é™…å­˜åœ¨çš„æ¨¡å‹: `User`, `Scene`, `Feedback`

### 3. æµ‹è¯•fixtureé…ç½®
**é—®é¢˜**: æµ‹è¯•æ•°æ®åˆå§‹åŒ–å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
- æ›´æ–° `init_database` fixture ä»¥ä½¿ç”¨å®é™…çš„æ•°æ®åº“æ¨¡å‹
- ä½¿ç”¨ `werkzeug.security.generate_password_hash` åˆ›å»ºå¯†ç å“ˆå¸Œ
- åˆ›å»ºæµ‹è¯•åœºæ™¯è€Œä¸æ˜¯æµ‹è¯•é—®é¢˜ï¼ˆå› ä¸ºæ²¡æœ‰Questionæ¨¡å‹ï¼‰

##  å½“å‰æµ‹è¯•çŠ¶æ€

### âœ… é€šè¿‡çš„æµ‹è¯• (11ä¸ª)
1. `test_smoke.py` - æ‰€æœ‰åŸºç¡€ç«¯ç‚¹æµ‹è¯•é€šè¿‡ (6ä¸ªæµ‹è¯•)
   - health_check
   - root_endpoint  
   - scenes_endpoint
   - greeting_endpoint
   - chat_endpoint_exists
   - feedback_endpoint_exists

2. `test_services.py` - æœåŠ¡å±‚æµ‹è¯•é€šè¿‡ (4ä¸ªæµ‹è¯•)
   - process_chat_prompt_basic
   - process_chat_prompt_with_scene
   - generate_response_basic
   - generate_response_with_scene

3. `test_questions.py` - éƒ¨åˆ†é€šè¿‡ (1ä¸ªæµ‹è¯•)
   - test_get_nonexistent_question

### âŒ å¤±è´¥çš„æµ‹è¯• (49ä¸ª)

**ä¸»è¦åŸå› **: æµ‹è¯•ä¸­ä½¿ç”¨çš„APIç«¯ç‚¹ä¸å­˜åœ¨æˆ–è·¯å¾„ä¸æ­£ç¡®

è¿”å›404çš„ç«¯ç‚¹åŒ…æ‹¬:
- `/auth/register` - åº”è¯¥æ˜¯ `/api/auth/register`æˆ–ä¸å­˜åœ¨
- `/auth/logout` - å¯èƒ½ä¸å­˜åœ¨
- `/auth/profile` - å¯èƒ½ä¸å­˜åœ¨
- `/feedback` - ç«¯ç‚¹å¯èƒ½éœ€è¦ä¸åŒçš„å‚æ•°æˆ–è·¯å¾„
- `/questions` - ç«¯ç‚¹å¯èƒ½ä¸å­˜åœ¨ï¼ˆæ²¡æœ‰Questionæ¨¡å‹ï¼‰
- `/search` - æœç´¢ç«¯ç‚¹è·¯å¾„å¯èƒ½ä¸æ­£ç¡®
- `/analytics/*` - åˆ†æç«¯ç‚¹å¯èƒ½éœ€è¦ä¸åŒè·¯å¾„

### âš ï¸ æœ‰é”™è¯¯çš„æµ‹è¯• (7ä¸ª)

**åŸå› **: æ—§çš„æµ‹è¯•æ–‡ä»¶(`test_chat.py`, `test_scenes.py`)ä»ç„¶å°è¯•ä½¿ç”¨ä¸å­˜åœ¨çš„ `app` fixture

**éœ€è¦ä¿®å¤**: è¿™äº›æ–‡ä»¶éœ€è¦ç§»é™¤å¯¹ `app` çš„ç›´æ¥å¼•ç”¨

## ğŸ“‹ å»ºè®®çš„åç»­æ­¥éª¤

### ä¼˜å…ˆçº§1: ä¿®å¤åŸºç¡€ç»“æ„é—®é¢˜
1. âœ… åˆ é™¤æˆ–ç¦ç”¨ä¸é€‚ç”¨çš„æµ‹è¯•æ–‡ä»¶
2. âœ… ä¸“æ³¨äºå®é™…å­˜åœ¨çš„APIç«¯ç‚¹

### ä¼˜å…ˆçº§2: é€‚é…æµ‹è¯•åˆ°å®é™…API
éœ€è¦æ£€æŸ¥å®é™…çš„APIç»“æ„å¹¶æ›´æ–°æµ‹è¯•ï¼š
- ç¡®è®¤è®¤è¯APIçš„å®é™…è·¯å¾„å’Œå‚æ•°
- ç¡®è®¤æ˜¯å¦å­˜åœ¨é—®é¢˜ç®¡ç†API
- ç¡®è®¤åé¦ˆAPIçš„å®é™…å®ç°
- ç¡®è®¤æœç´¢APIçš„å®é™…è·¯å¾„

### ä¼˜å…ˆçº§3: æ‰©å±•smokeæµ‹è¯•
åŸºäºé€šè¿‡çš„smokeæµ‹è¯•ï¼Œå¯ä»¥æ‰©å±•æ›´å¤šåŸºæœ¬ç«¯ç‚¹æµ‹è¯•

## ğŸ¯ å½“å‰å¯ç”¨çš„æµ‹è¯•

### ç«‹å³å¯ç”¨
```bash
cd backend

# è¿è¡ŒåŸºç¡€smokeæµ‹è¯• (6ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡)
pytest tests/test_smoke.py -v

# è¿è¡ŒæœåŠ¡å±‚æµ‹è¯• (4ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡)
pytest tests/test_services.py -v

# è¿è¡Œæ‰€æœ‰é€šè¿‡çš„æµ‹è¯•
pytest tests/test_smoke.py tests/test_services.py -v
```

### æµ‹è¯•ç»“æœ
```
âœ… test_smoke.py: 6 passed
âœ… test_services.py: 4 passed
æ€»è®¡: 11ä¸ªæµ‹è¯•é€šè¿‡
```

## ğŸ“Š æµ‹è¯•è¦†ç›–ç°çŠ¶

| æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| åŸºç¡€ç«¯ç‚¹ | âœ… é€šè¿‡ | health, root, scenes, greeting |
| èŠå¤©æœåŠ¡ | âœ… é€šè¿‡ | æœåŠ¡å±‚æµ‹è¯•é€šè¿‡ |
| RAGæœåŠ¡ | âœ… é€šè¿‡ | åŸºæœ¬åŠŸèƒ½æµ‹è¯•é€šè¿‡ |
| è®¤è¯ | âŒ éœ€è¦é€‚é… | ç«¯ç‚¹è·¯å¾„éœ€è¦ç¡®è®¤ |
| é—®é¢˜ç®¡ç† | âŒ å¯èƒ½ä¸é€‚ç”¨ | æ²¡æœ‰Questionæ¨¡å‹ |
| åé¦ˆç³»ç»Ÿ | âŒ éœ€è¦é€‚é… | ç«¯ç‚¹å‚æ•°éœ€è¦ç¡®è®¤ |
| æœç´¢åŠŸèƒ½ | âŒ éœ€è¦é€‚é… | ç«¯ç‚¹è·¯å¾„éœ€è¦ç¡®è®¤ |
| åˆ†æç»Ÿè®¡ | âŒ éœ€è¦é€‚é… | ç«¯ç‚¹è·¯å¾„éœ€è¦ç¡®è®¤ |

## ğŸ› ï¸ å¿«é€Ÿä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: æœ€å°å¯ç”¨æµ‹è¯•é›†ï¼ˆæ¨èï¼‰
ä¿ç•™å·²é€šè¿‡çš„æµ‹è¯•ï¼Œç¦ç”¨å¤±è´¥çš„æµ‹è¯•ï¼š

```bash
# é‡å‘½åå¤±è´¥çš„æµ‹è¯•æ–‡ä»¶
cd backend/tests
for file in test_auth.py test_questions.py test_feedback.py test_search.py test_analytics.py test_integration.py test_performance.py; do
    mv $file ${file}.disabled
done

# ä¿®å¤ test_chat.py å’Œ test_scenes.py
# ç„¶åè¿è¡Œæµ‹è¯•
pytest -v
```

### æ–¹æ¡ˆ2: åˆ›å»ºç²¾ç®€æµ‹è¯•é›†
åŸºäºå®é™…APIåˆ›å»ºæ–°çš„æµ‹è¯•æ–‡ä»¶ï¼Œä¸“æ³¨äºï¼š
1. å·²çŸ¥å­˜åœ¨çš„ç«¯ç‚¹
2. å®é™…çš„æ•°æ®æ¨¡å‹
3. çœŸå®çš„ä¸šåŠ¡æµç¨‹

## ğŸ“ åˆ›å»ºçš„æ–‡ä»¶æ€»ç»“

### æˆåŠŸåˆ›å»ºå¹¶å¯ç”¨
- âœ… `backend/tests/conftest.py` - é…ç½®æ­£ç¡®
- âœ… `backend/tests/test_smoke.py` - å…¨éƒ¨é€šè¿‡
- âœ… `backend/tests/test_services.py` - å…¨éƒ¨é€šè¿‡
- âœ… `backend/pytest.ini` - é…ç½®æ–‡ä»¶

### éœ€è¦é€‚é…å®é™…API
- âš ï¸ `backend/tests/test_auth.py`
- âš ï¸ `backend/tests/test_questions.py`
- âš ï¸ `backend/tests/test_feedback.py`
- âš ï¸ `backend/tests/test_search.py`
- âš ï¸ `backend/tests/test_analytics.py`
- âš ï¸ `backend/tests/test_integration.py`
- âš ï¸ `backend/tests/test_performance.py`

### æœ‰é”™è¯¯éœ€è¦ä¿®å¤
- âŒ `backend/tests/test_chat.py` - éœ€è¦ç§»é™¤appå¼•ç”¨
- âŒ `backend/tests/test_scenes.py` - éœ€è¦ç§»é™¤appå¼•ç”¨

## ğŸ¯ ç»“è®º

**å¥½æ¶ˆæ¯**: 
- âœ… æµ‹è¯•æ¡†æ¶é…ç½®æ­£ç¡®
- âœ… Pytestè¿è¡Œæ­£å¸¸
- âœ… åŸºç¡€smokeæµ‹è¯•å…¨éƒ¨é€šè¿‡(6/6)
- âœ… æœåŠ¡å±‚æµ‹è¯•å…¨éƒ¨é€šè¿‡(4/4)
- âœ… æ€»å…±11ä¸ªæµ‹è¯•ç¨³å®šé€šè¿‡

**éœ€è¦æ”¹è¿›**:
- å¤§éƒ¨åˆ†å¤±è´¥æ˜¯å› ä¸ºæµ‹è¯•å‡è®¾çš„APIç«¯ç‚¹ä¸å®é™…ä¸ç¬¦
- éœ€è¦æ ¹æ®å®é™…çš„APIç»“æ„è°ƒæ•´æµ‹è¯•
- å»ºè®®å…ˆä½¿ç”¨smokeæµ‹è¯•éªŒè¯åŸºæœ¬åŠŸèƒ½
- ç„¶åé€æ­¥æ·»åŠ é’ˆå¯¹å®é™…APIçš„æµ‹è¯•

**æ¨èåšæ³•**:
1. ä½¿ç”¨å·²é€šè¿‡çš„smokeæµ‹è¯•å’ŒæœåŠ¡æµ‹è¯•
2. åŸºäºå®é™…APIé€æ­¥æ·»åŠ æ–°æµ‹è¯•
3. ä¸è¦ç›²ç›®ä½¿ç”¨å‡è®¾çš„APIç«¯ç‚¹
4. å…ˆç¡®è®¤APIå­˜åœ¨ï¼Œå†ç¼–å†™æµ‹è¯•

---

**å½“å‰å¯ç”¨å‘½ä»¤**:
```bash
# è¿è¡Œæ‰€æœ‰é€šè¿‡çš„æµ‹è¯•
cd backend
pytest tests/test_smoke.py tests/test_services.py -v

# æŸ¥çœ‹è¦†ç›–ç‡
pytest tests/test_smoke.py tests/test_services.py --cov=. --cov-report=html
```
