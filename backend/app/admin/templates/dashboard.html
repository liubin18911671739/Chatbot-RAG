<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAG智能问答系统 - 管理仪表盘</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Chart.js -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- 侧边导航栏 -->
            <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-dark sidebar collapse">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <h5 class="text-white">RAG智能问答系统</h5>
                        <p class="text-light opacity-75 small mb-0">管理控制台</p>
                    </div>
                    <hr class="text-light opacity-25">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="{{ url_for('admin.dashboard') }}">
                                <i class="bi bi-speedometer2 me-2"></i>仪表盘
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.agent_config') }}">
                                <i class="bi bi-robot me-2"></i>智能体配置
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.document_manager') }}">
                                <i class="bi bi-file-text me-2"></i>文档管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.conversation_history') }}">
                                <i class="bi bi-chat-dots me-2"></i>对话历史
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.system_settings') }}">
                                <i class="bi bi-gear me-2"></i>系统设置
                            </a>
                        </li>
                        <hr class="text-light opacity-25">
                        <li class="nav-item">
                            <a class="nav-link text-danger" href="{{ url_for('admin.logout') }}">
                                <i class="bi bi-box-arrow-right me-2"></i>安全登出
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- 主内容区 -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">系统仪表盘</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <div class="btn-group me-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary" id="refresh-btn">
                                <i class="bi bi-arrow-clockwise"></i> 刷新数据
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-secondary">
                                <i class="bi bi-download"></i> 导出报告
                            </button>
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                <i class="bi bi-calendar3"></i> 最近30天
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#">今天</a></li>
                                <li><a class="dropdown-item" href="#">最近7天</a></li>
                                <li><a class="dropdown-item" href="#">最近30天</a></li>
                                <li><a class="dropdown-item" href="#">本月</a></li>
                                <li><a class="dropdown-item" href="#">自定义...</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 状态摘要卡片 -->
                <div class="row row-cols-1 row-cols-md-2 row-cols-xl-4 g-4 mb-4">
                    <div class="col">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="card-title text-muted">智能体状态</h6>
                                        <h3 class="text-success fw-bold">运行中</h3>
                                    </div>
                                    <span class="bg-success bg-opacity-10 p-2 rounded">
                                        <i class="bi bi-robot text-success fs-3"></i>
                                    </span>
                                </div>
                                <p class="card-text small mt-2 mb-0">上次活动: 3分钟前</p>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="card-title text-muted">索引文档数</h6>
                                        <h3 class="fw-bold" id="docs-count">256</h3>
                                    </div>
                                    <span class="bg-primary bg-opacity-10 p-2 rounded">
                                        <i class="bi bi-file-text text-primary fs-3"></i>
                                    </span>
                                </div>
                                <p class="card-text small mt-2 mb-0">今日新增: <span class="text-success">+12</span></p>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="card-title text-muted">今日对话数</h6>
                                        <h3 class="fw-bold">124</h3>
                                    </div>
                                    <span class="bg-warning bg-opacity-10 p-2 rounded">
                                        <i class="bi bi-chat-dots text-warning fs-3"></i>
                                    </span>
                                </div>
                                <p class="card-text small mt-2 mb-0">平均响应时间: <span class="text-success">1.2秒</span></p>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="card-title text-muted">系统负载</h6>
                                        <h3 class="fw-bold">42%</h3>
                                    </div>
                                    <span class="bg-info bg-opacity-10 p-2 rounded">
                                        <i class="bi bi-cpu text-info fs-3"></i>
                                    </span>
                                </div>
                                <div class="progress mt-2" style="height: 5px;">
                                    <div class="progress-bar bg-info" role="progressbar" style="width: 42%"></div>
                                </div>
                                <p class="card-text small mt-2 mb-0">内存使用: 2.1GB / 4GB</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 数据可视化区域 -->
                <div class="row mb-4">
                    <div class="col-md-8">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="card-title mb-0">对话趋势</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="conversation-trend-chart" height="250"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="card-title mb-0">知识库分布</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="knowledge-distribution-chart" height="250"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 最近对话表格 -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">最近对话记录</h5>
                        <div class="input-group input-group-sm" style="width: 250px;">
                            <input type="text" class="form-control" placeholder="搜索对话..." id="conversation-search">
                            <button class="btn btn-outline-secondary" type="button"><i class="bi bi-search"></i></button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th scope="col" style="width: 35%">用户问题</th>
                                        <th scope="col" style="width: 35%">AI回答</th>
                                        <th scope="col">场景</th>
                                        <th scope="col">时间</th>
                                        <th scope="col">操作</th>
                                    </tr>
                                </thead>
                                <tbody id="conversation-table-body">
                                    <!-- 示例数据，将由JS动态替换 -->
                                    <tr>
                                        <td>请介绍一下学校的历史</td>
                                        <td>本校创建于1949年，是新中国成立后第一批建立的高等院校之一...</td>
                                        <td><span class="badge bg-light text-dark">通用</span></td>
                                        <td>2025-03-23 10:23</td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-outline-primary"><i class="bi bi-eye"></i></button>
                                                <button class="btn btn-outline-danger"><i class="bi bi-trash"></i></button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>如何申请奖学金？</td>
                                        <td>申请奖学金需要满足以下条件：1.学习成绩优秀；2.无违纪行为...</td>
                                        <td><span class="badge bg-light text-dark">学校</span></td>
                                        <td>2025-03-23 09:45</td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-outline-primary"><i class="bi bi-eye"></i></button>
                                                <button class="btn btn-outline-danger"><i class="bi bi-trash"></i></button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>如何理解中国特色社会主义？</td>
                                        <td>中国特色社会主义是中国共产党领导的社会主义事业在中国的实践...</td>
                                        <td><span class="badge bg-light text-dark">思政</span></td>
                                        <td>2025-03-23 08:32</td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-outline-primary"><i class="bi bi-eye"></i></button>
                                                <button class="btn btn-outline-danger"><i class="bi bi-trash"></i></button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer bg-white">
                        <nav aria-label="Page navigation">
                            <ul class="pagination pagination-sm justify-content-end mb-0">
                                <li class="page-item disabled"><a class="page-link" href="#">上一页</a></li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item"><a class="page-link" href="#">2</a></li>
                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                                <li class="page-item"><a class="page-link" href="#">下一页</a></li>
                            </ul>
                        </nav>
                    </div>
                </div>

                <!-- 系统性能监控 -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white">
                        <h5 class="card-title mb-0">系统性能监控</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <h6 class="text-muted">CPU使用率</h6>
                                <div class="progress" style="height: 10px;">
                                    <div class="progress-bar bg-primary" role="progressbar" style="width: 42%" aria-valuenow="42" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <div class="d-flex justify-content-between mt-2">
                                    <small class="text-muted">42%</small>
                                    <small class="text-muted">过去1小时平均: 38%</small>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4">
                                <h6 class="text-muted">内存使用率</h6>
                                <div class="progress" style="height: 10px;">
                                    <div class="progress-bar bg-success" role="progressbar" style="width: 65%" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <div class="d-flex justify-content-between mt-2">
                                    <small class="text-muted">65%</small>
                                    <small class="text-muted">2.6GB / 4GB</small>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4">
                                <h6 class="text-muted">API调用速率</h6>
                                <div class="progress" style="height: 10px;">
                                    <div class="progress-bar bg-info" role="progressbar" style="width: 28%" aria-valuenow="28" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <div class="d-flex justify-content-between mt-2">
                                    <small class="text-muted">28%</small>
                                    <small class="text-muted">14 请求/分钟</small>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4">
                                <h6 class="text-muted">磁盘使用率</h6>
                                <div class="progress" style="height: 10px;">
                                    <div class="progress-bar bg-warning" role="progressbar" style="width: 52%" aria-valuenow="52" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <div class="d-flex justify-content-between mt-2">
                                    <small class="text-muted">52%</small>
                                    <small class="text-muted">156GB / 300GB</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- 自定义JS -->
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
    
    <!-- 简单的图表初始化脚本示例 -->
    <script>
        // 对话趋势图表
        const trendCtx = document.getElementById('conversation-trend-chart').getContext('2d');
        const trendChart = new Chart(trendCtx, {
            type: 'line',
            data: {
                labels: ['3/17', '3/18', '3/19', '3/20', '3/21', '3/22', '3/23'],
                datasets: [{
                    label: '对话数量',
                    data: [92, 105, 132, 118, 154, 142, 124],
                    borderColor: '#0d6efd',
                    backgroundColor: 'rgba(13, 110, 253, 0.1)',
                    tension: 0.2,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            drawBorder: false
                        }
                    },
                    x: {
                        grid: {
                            display: false,
                            drawBorder: false
                        }
                    }
                }
            }
        });

        // 知识库分布饼图
        const distributionCtx = document.getElementById('knowledge-distribution-chart').getContext('2d');
        const distributionChart = new Chart(distributionCtx, {
            type: 'doughnut',
            data: {
                labels: ['通用知识', '学校文档', '思政资料', '课程内容', '校园活动'],
                datasets: [{
                    data: [35, 25, 15, 15, 10],
                    backgroundColor: [
                        '#0d6efd', '#6f42c1', '#fd7e14', '#20c997', '#ffc107'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            boxWidth: 15,
                            padding: 15
                        }
                    }
                },
                cutout: '60%'
            }
        });
        
        // 刷新按钮事件处理
        document.getElementById('refresh-btn').addEventListener('click', function() {
            // 实际项目中应从API获取最新数据
            alert('正在刷新数据...');
            // 模拟刷新后的操作
            setTimeout(() => {
                document.getElementById('docs-count').textContent = '264';
                alert('数据已刷新');
            }, 1000);
        });
    </script>
</body>
</html>