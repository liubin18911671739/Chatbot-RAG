# 微信小程序域名白名单配置指南

## 问题描述
当前遇到的域名白名单错误是因为API地址 `http://10.10.15.211:5000` 没有在微信小程序的合法域名列表中配置。

## 解决方案

### 1. 开发环境临时解决方案（当前已配置）

在 `project.config.json` 中设置：
```json
{
  "setting": {
    "urlCheck": false,
    "ignoreHttps": true,
    "checkSiteMap": false,
    "disableUseStrict": false
  }
}
```

**优点：**
- 立即生效，无需额外配置
- 适合开发和测试阶段

**缺点：**
- 仅在开发者工具中有效
- 真机预览和发布时无效

### 2. 微信公众平台配置（生产环境必需）

#### 步骤 1：登录微信公众平台
1. 访问 [微信公众平台](https://mp.weixin.qq.com/)
2. 使用小程序账号登录

#### 步骤 2：配置服务器域名
1. 进入 "开发管理" → "开发设置"
2. 找到 "服务器域名" 部分
3. 点击 "修改" 按钮

#### 步骤 3：添加合法域名
在 "request合法域名" 中添加：
```
https://yourdomain.com  # 您的正式API域名
```

**注意：**
- 微信小程序只支持 HTTPS 协议
- 不支持 IP 地址，必须是域名
- 域名需要备案（中国大陆）

### 3. 推荐的生产环境配置

#### 方案A：使用HTTPS域名
1. 申请一个域名（如 `api.yourcompany.com`）
2. 配置SSL证书，启用HTTPS
3. 将API服务部署到该域名
4. 在微信公众平台添加该域名到白名单

#### 方案B：使用云服务
1. 腾讯云（推荐，与微信生态集成更好）
   - 使用腾讯云云函数
   - 自动获得HTTPS域名
   - 无需额外配置白名单

2. 阿里云、华为云等
   - 使用云函数或API网关
   - 配置自定义域名和SSL证书

### 4. 当前项目的临时解决方案

我已经为您配置了环境管理系统，支持：

#### 自动环境检测
```javascript
// 开发环境：开发者工具
// 测试环境：体验版
// 生产环境：正式版
```

#### 灵活的API配置
```javascript
// 开发环境
development: {
  baseURL: 'http://10.10.15.211:5000',  // 当前可用
  timeout: 40000
}

// 生产环境
production: {
  baseURL: 'https://api.yourdomain.com', // 需要配置
  timeout: 30000
}
```

#### 网络状态监控
- 自动检测网络连接
- 显示网络状态变化
- 提供用户友好的错误提示

## 下一步行动计划

### 立即可做（开发阶段）
- [x] 配置开发环境跳过域名检查
- [x] 添加网络状态监控
- [x] 实现环境配置管理
- [ ] 测试所有功能是否正常

### 准备发布前
- [ ] 申请正式域名
- [ ] 配置HTTPS证书
- [ ] 部署API服务到HTTPS域名
- [ ] 在微信公众平台配置合法域名
- [ ] 更新生产环境配置
- [ ] 进行真机测试

### 可选优化
- [ ] 考虑使用腾讯云云函数
- [ ] 实现API缓存机制
- [ ] 添加离线模式支持

## 测试验证

### 开发环境测试
1. 在微信开发者工具中测试发送消息
2. 检查网络请求是否正常
3. 验证错误处理机制

### 真机测试（需要正式域名）
1. 生成体验版二维码
2. 使用手机扫码测试
3. 验证所有功能

## 常见问题

### Q: 为什么设置了urlCheck: false还是报错？
A: 该设置只在开发者工具中生效，真机预览时仍需要配置合法域名。

### Q: 能否使用IP地址？
A: 微信小程序不支持IP地址，必须使用域名。

### Q: HTTP协议是否支持？
A: 微信小程序只支持HTTPS协议（开发环境除外）。

### Q: 如何快速获得HTTPS域名？
A: 推荐使用腾讯云云函数，自动提供HTTPS访问地址。
