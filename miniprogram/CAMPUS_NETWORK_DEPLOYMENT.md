# 校园网络限制功能部署指南

## 概述
本文档详细说明了如何为北京第二外国语学院微信小程序部署和配置校园网络限制功能。

## 部署前准备

### 1. 环境配置
确保以下文件已正确配置：

#### config/env.js
```javascript
// 生产环境配置
const production = {
  API_BASE_URL: 'https://10.10.15.210:5000',
  campusRestriction: {
    enabled: true,
    allowDevelopment: false,
    strictMode: true
  }
}

// 开发环境配置
const development = {
  API_BASE_URL: 'http://localhost:5000',
  campusRestriction: {
    enabled: false,
    allowDevelopment: true,
    strictMode: false
  }
}
```

### 2. 网络环境要求
- 校园内部API服务器: 10.10.15.211, 10.10.15.210
- 校园网IP段: 10.10.0.0/16, 192.168.0.0/16, 172.16.0.0/12
- GPS定位服务可用
- 防火墙允许API访问

## 部署步骤

### 1. 上传小程序代码
```bash
# 使用微信开发者工具上传代码包
# 确保所有网络限制相关文件已包含
```

### 2. 配置服务器白名单
在微信小程序后台配置以下域名：
- request域名: https://10.10.15.210, https://10.10.15.211
- downloadFile域名: 根据实际需求配置

### 3. 测试网络验证
使用以下工具测试网络验证功能：

#### 校园网环境测试
```javascript
// 在小程序中调用
const networkValidator = require('../../utils/network-validator.js');

// 测试API连通性
networkValidator.testCampusAPI().then(result => {
  console.log('API测试结果:', result);
});

// 测试IP范围
const isValidIP = networkValidator.isInCampusIPRange('10.10.15.100');
console.log('IP验证结果:', isValidIP);
```

## 管理员配置

### 1. 首次配置
1. 进入"个人中心" -> "管理员配置"
2. 输入默认密码: `bisu2024admin`
3. 配置网络限制策略

### 2. 日常管理
- 监控访问日志
- 调整限制策略
- 处理异常访问

## 故障排除

### 常见问题

#### 1. 无法访问小程序
**症状**: 用户看到"访问被拒绝"页面
**排查步骤**:
1. 检查用户网络环境是否为校园网
2. 验证校园API服务器是否可达
3. 检查用户GPS定位是否开启
4. 查看访问日志确认拒绝原因

#### 2. API连接失败
**症状**: 网络验证总是失败
**排查步骤**:
1. 确认API服务器状态正常
2. 检查防火墙配置
3. 验证小程序域名白名单
4. 测试网络连通性

#### 3. 管理员无法登录
**症状**: 输入密码后无法进入管理界面
**解决方案**:
1. 确认密码正确: `bisu2024admin`
2. 清除小程序缓存重试
3. 检查管理员认证逻辑

## 监控和维护

### 1. 访问日志监控
定期检查访问日志，关注：
- 异常访问尝试
- 网络验证失败率
- 用户访问模式

### 2. 系统健康检查
- 每日检查API服务器状态
- 监控网络验证成功率
- 验证地理位置服务可用性

### 3. 定期维护
- 备份管理员配置
- 清理过期访问日志
- 更新校园网IP范围

## 安全建议

### 1. 密码管理
- 定期更换管理员密码
- 使用强密码策略
- 限制管理员访问次数

### 2. 网络安全
- 启用HTTPS加密
- 配置适当的防火墙规则
- 监控异常访问行为

### 3. 数据保护
- 定期备份配置数据
- 加密敏感信息存储
- 实施访问日志审计

## 应急处理

### 紧急情况处理流程

#### 1. 系统完全无法访问
1. 检查网络环境
2. 临时禁用网络限制(开发模式)
3. 联系技术支持

#### 2. 大量用户无法访问
1. 查看系统监控
2. 检查API服务器状态
3. 调整限制策略
4. 发布用户通知

## 联系信息
- 技术支持邮箱: support@bisu.edu.cn
- 紧急联系电话: 010-65778XXX
- 工作时间: 周一至周五 9:00-17:00

## 附录

### A. 配置文件模板
参考各配置文件的完整模板配置。

### B. API接口文档
详细的网络验证API接口说明。

### C. 错误代码对照表
常见错误代码及其含义解释。
