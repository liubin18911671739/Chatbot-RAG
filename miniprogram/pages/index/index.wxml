<!--pages/index/index.wxml-->
<view class="container">
  <!-- å¤´éƒ¨æ¬¢è¿åŒº -->
  <view class="header-section">
    <view class="logo-container">
      <image class="logo" src="/images/logo.png" mode="aspectFit"></image>
      <view class="app-title">æ£ å¿ƒé—®ç­”</view>
      <view class="app-subtitle">åŒ—äº¬ç¬¬äºŒå¤–å›½è¯­å­¦é™¢AIåŠ©æ‰‹</view>
    </view>
    
    <!-- ç”¨æˆ·ä¿¡æ¯åŒº -->
    <view class="user-section">
      <view wx:if="{{isLoggedIn}}" class="user-info">
        <view class="user-display">
          <view class="username">{{userInfo.username}}</view>
          <view class="auth-type">{{userInfo.authType === 'RADIUS' ? 'è®¤è¯æˆåŠŸ' : 'å¼€å‘æ¨¡å¼'}}</view>
        </view>
        <button class="logout-btn btn btn-outline" bindtap="onLogout" size="mini">é€€å‡º</button>
      </view>
      <view wx:elif="{{hasUserInfo}}" class="user-info">
        <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
        <text class="nickname">{{userInfo.nickName}}</text>
      </view>
      <button wx:else class="login-btn btn btn-primary" bindtap="showLogin">
        ç™»å½•
      </button>
    </view>
  </view>

  <!-- æ¬¢è¿æ¶ˆæ¯ -->
  <view class="greeting-section card">
    <view class="greeting-icon">ğŸ“</view>
    <view class="greeting-text">{{greeting}}</view>
  </view>

  <!-- å¿«é€Ÿæ“ä½œ -->
  <view class="quick-actions">
    <view class="action-item" bindtap="startNewChat">
      <view class="action-icon">ğŸ’¬</view>
      <view class="action-text">å¼€å§‹å¯¹è¯</view>
    </view>
    <!-- <view class="action-item" bindtap="selectScene">
      <view class="action-icon">ğŸ“š</view>
      <view class="action-text">é€‰æ‹©åœºæ™¯</view>
    </view> -->
  </view>

  <!-- æ¨èé—®é¢˜ -->
  <view wx:if="{{quickQuestions.length > 0}}" class="section">
    <view class="section-title">æ¨èé—®é¢˜</view>
    <view class="quick-questions">
      <view 
        wx:for="{{quickQuestions}}" 
        wx:key="index"
        class="question-item"
        data-question="{{item}}"
        bindtap="onQuickQuestionTap"
      >
        {{item}}
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘èŠå¤© -->
  <view wx:if="{{recentChats.length > 0}}" class="section">
    <view class="section-header">
      <view class="section-title">æœ€è¿‘èŠå¤©</view>
      <view class="more-link" bindtap="viewMoreHistory">æŸ¥çœ‹æ›´å¤š</view>
    </view>
    <view class="recent-chats">
      <view 
        wx:for="{{recentChats}}" 
        wx:key="sceneId"
        class="chat-item card"
        data-scene-id="{{item.sceneId}}"
        bindtap="onRecentChatTap"
      >
        <view class="chat-preview">
          <view class="chat-content">{{item.lastMessage.content}}</view>
          <view class="chat-time">{{item.timestamp}}</view>
        </view>
        <view class="chat-meta">
          <view class="message-count">{{item.messageCount}}æ¡æ¶ˆæ¯</view>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{isLoading}}" class="loading">
    <view class="loading-dots">
      <view class="loading-dot"></view>
      <view class="loading-dot"></view>
      <view class="loading-dot"></view>
    </view>
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>
</view>

<!-- RADIUSç™»å½•å¼¹çª— -->
<view wx:if="{{showLoginModal}}" class="login-modal">
  <view class="modal-mask" bindtap="hideLogin"></view>
  <view class="modal-content">
    <view class="modal-header">
      <view class="modal-title">è®¤è¯ç™»å½•</view>
      <view class="modal-close" bindtap="hideLogin">Ã—</view>
    </view>
    
    <view class="modal-body">
      <view class="input-group">
        <view class="input-label">ç”¨æˆ·å</view>
        <input 
          class="input-field" 
          placeholder="è¯·è¾“å…¥ç”¨æˆ·å" 
          value="{{username}}"
          bindinput="onUsernameInput"
          maxlength="50"
        />
      </view>
      
      <view class="input-group">
        <view class="input-label">å¯†ç </view>
        <input 
          class="input-field" 
          placeholder="è¯·è¾“å…¥å¯†ç " 
          password="{{true}}"
          value="{{password}}"
          bindinput="onPasswordInput"
          maxlength="50"
        />
      </view>
      
      <view class="login-tips">
        <text class="tip-text">è¯·ä½¿ç”¨æ‚¨çš„æ ¡å›­ç½‘è´¦å·ç™»å½•</text>
        <!-- <text class="dev-tip">å¼€å‘æ¨¡å¼æµ‹è¯•è´¦å·: testing / password</text> -->
      </view>
    </view>
    
    <view class="modal-footer">
      <button 
        class="login-submit-btn btn btn-primary"
        bindtap="onRadiusLogin"
        loading="{{loginLoading}}"
        disabled="{{loginLoading}}"
      >
        {{loginLoading ? 'ç™»å½•ä¸­...' : 'ç™»å½•'}}
      </button>
    </view>
  </view>
</view>
